{"version":3,"file":"loading.min.js","sources":["loading.esm.js"],"sourcesContent":["/**\n * A jQuery plugin to add/remove classes to a collection while a promise is pending or something is loading asynchronously.\n *\n * @license MIT\n * @author Dumitru Uzun (DUzun.Me)\n * @version 1.4.0\n */\nexport default function initLoading($) {\n    const lck = '_loading_class_';\n    const lcd = lck + 'disabled_';\n    const prp = 'disabled';\n    /**\n     * Adds/Removes loading class on the collection.\n     *\n     * Usage:\n     *   1)\n     *       $('selector').loading('loading'); // add class\n     *       ...\n     *       $('selector').loading(false); // remove added loading class\n     *\n     *   2)\n     *       const done = $('selector').loading('loading', true); // add class and get the callback\n     *       ...\n     *       done(); // remove added loading class\n     *\n     *   3)\n     *       $('selector').loading('loading', promise); // add class and remove on promise resolve or reject\n     *\n     *   4)\n     *       const done = $('selector').loading('loading', promise); // add class and remove on promise resolve or reject\n     *       setTimeout(done, 5e3); // timeout if promise takes too long\n     *\n     * @param {String|Array} classes  - classes to be added to collection while loading\n     * @param {Boolean|Promise} retCb - if true, return a done() function to be called when done loading\n     *                                - if a promise, remove classes on resolve or reject\n     *\n     * @return {jQuery|Function} - by default (no retCb) it returns the jQuery collection (this),\n     *                             but if retCb not falsy, done() function returned\n     */\n    const loading = function loading(classes, retCb = undefined) {\n        const that = this;\n        if (classes === false) {\n            that.each(function (i, e) {\n                e = $(e);\n                i = e.data(lck);\n                if (i) {\n                    e.removeClass(i).data(lck, undefined);\n                }\n                i = e.data(lcd);\n                if (i) {\n                    e.attr(i, null).prop(i, false).data(lcd, undefined);\n                }\n            });\n        }\n        else {\n            if (retCb) {\n                // On `.disabled = true` the element loses focus\n                const focused = that.filter(isFocused);\n                that.addClass(classes).attr(prp, prp).prop(prp, true);\n                let done = function (a) {\n                    // Prevent calling it more then once\n                    if (done) {\n                        that.removeClass(classes).attr(prp, null).prop(prp, false);\n                        done = undefined;\n                        // Restore the focus on `.disabled = false`\n                        focused.each(reFocusIf);\n                    }\n                    return arguments.length == 1 ? a : that; // in Promises return the result without altering it\n                };\n                // If retCb is a promise, call done() on resolve and reject\n                if (retCb !== true && $.isFunction(retCb.then)) {\n                    retCb.then(done, done);\n                }\n                return done;\n            }\n            that.each(function (i, e) {\n                e = $(e);\n                i = e.data(lck);\n                e.data(lck, (i ? i + ' ' : '') + classes);\n                if (!e.prop(prp)) {\n                    e.attr(prp, prp).prop(prp, true).data(lcd, prp);\n                }\n            })\n                .addClass(classes);\n        }\n        return that;\n    };\n    $.fn.loading = loading;\n    function isFocused() {\n        const elem = this;\n        return elem.ownerDocument.activeElement === elem;\n    }\n    function reFocusIf() {\n        const elem = this;\n        const { ownerDocument } = elem;\n        const { activeElement } = ownerDocument;\n        // Avoid re-focusing if another element or elem it is focused\n        if (activeElement && (activeElement === elem || activeElement !== ownerDocument.body))\n            return;\n        // Avoid re-focusing if out of viewport to avoid scrolling the page\n        if (!isOnViewport(elem))\n            return;\n        return elem.focus();\n    }\n    // A better inView() version sketch\n    function isOnViewport(elem) {\n        if (!elem.getBoundingClientRect)\n            return;\n        const rect = elem.getBoundingClientRect();\n        if (!rect.height && !rect.width)\n            return false; // display: none ?\n        if (rect.top < 0 || rect.left < 0)\n            return false;\n        const { ownerDocument } = elem;\n        const { documentElement } = ownerDocument;\n        let { clientHeight, clientWidth } = documentElement;\n        if (typeof window !== 'undefined' && window.innerHeight) {\n            clientHeight = window.innerHeight;\n            clientWidth = window.innerWidth;\n        }\n        return (rect.bottom <= clientHeight &&\n            rect.right <= clientWidth);\n    }\n    return loading;\n}\n// Auto-init in browser when jQuery or Zepto is present\nif (typeof window !== 'undefined') {\n    const $ = window.jQuery || window.Zepto;\n    if ($) {\n        initLoading($);\n    }\n}\n"],"names":["initLoading","$","lck","lcd","prp","loading","classes","retCb","undefined","that","this","each","i","e","data","removeClass","attr","prop","focused","filter","isFocused","addClass","done","a","reFocusIf","arguments","length","isFunction","then","ownerDocument","activeElement","elem","body","getBoundingClientRect","rect","height","width","top","left","documentElement","clientHeight","clientWidth","window","innerHeight","innerWidth","bottom","right","isOnViewport","focus","fn","jQuery","Zepto"],"mappings":";;;;;;;OAOe,SAASA,EAAYC,OAC1BC,EAAM,kBACNC,EAAMD,EAAM,YACZE,EAAM,WA6BNC,EAAU,SAAiBC,OAASC,8DAAQC,EACxCC,EAAOC,SACG,IAAZJ,EACAG,EAAKE,MAAK,SAAUC,EAAGC,IAEnBD,GADAC,EAAIZ,EAAEY,IACAC,KAAKZ,KAEPW,EAAEE,YAAYH,GAAGE,KAAKZ,OAAKM,IAE/BI,EAAIC,EAAEC,KAAKX,KAEPU,EAAEG,KAAKJ,EAAG,MAAMK,KAAKL,GAAG,GAAOE,KAAKX,OAAKK,UAIhD,IACGD,EAAO,KAEDW,EAAUT,EAAKU,OAAOC,GAC5BX,EAAKY,SAASf,GAASU,KAAKZ,EAAKA,GAAKa,KAAKb,GAAK,OAC5CkB,EAAO,SAAUC,UAEbD,IACAb,EAAKM,YAAYT,GAASU,KAAKZ,EAAK,MAAMa,KAAKb,GAAK,GACpDkB,OAAOd,EAEPU,EAAQP,KAAKa,IAEU,GAApBC,UAAUC,OAAcH,EAAId,UAGzB,IAAVF,GAAkBN,EAAE0B,WAAWpB,EAAMqB,OACrCrB,EAAMqB,KAAKN,EAAMA,GAEdA,EAEXb,EAAKE,MAAK,SAAUC,EAAGC,GAEnBD,GADAC,EAAIZ,EAAEY,IACAC,KAAKZ,GACXW,EAAEC,KAAKZ,GAAMU,EAAIA,EAAI,IAAM,IAAMN,GAC5BO,EAAEI,KAAKb,IACRS,EAAEG,KAAKZ,EAAKA,GAAKa,KAAKb,GAAK,GAAMU,KAAKX,EAAKC,MAG9CiB,SAASf,UAEXG,YAGFW,WACQV,KACDmB,cAAcC,gBADbpB,cAGRc,QACCO,EAAOrB,KACLmB,EAAkBE,EAAlBF,cACAC,EAAkBD,EAAlBC,mBAEJA,GAAkBA,IAAkBC,GAAQD,IAAkBD,EAAcG,gBAQ9DD,OACbA,EAAKE,sBACN,WACEC,EAAOH,EAAKE,4BACbC,EAAKC,SAAWD,EAAKE,MACtB,OAAO,KACPF,EAAKG,IAAM,GAAKH,EAAKI,KAAO,EAC5B,OAAO,MAEHC,EADkBR,EAAlBF,cACAU,gBACFC,EAA8BD,EAA9BC,aAAcC,EAAgBF,EAAhBE,YACE,oBAAXC,QAA0BA,OAAOC,cACxCH,EAAeE,OAAOC,YACtBF,EAAcC,OAAOE,mBAEjBV,EAAKW,QAAUL,GACnBN,EAAKY,OAASL,EArBbM,CAAahB,UAEXA,EAAKiB,eAfhB/C,EAAEgD,GAAG5C,QAAUA,EAoCRA,EAGX,GAAsB,oBAAXqC,OAAwB,KACzBzC,EAAIyC,OAAOQ,QAAUR,OAAOS,MAC9BlD,GACAD,EAAYC"}