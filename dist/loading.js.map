{"version":3,"file":"loading.js","sources":["loading.esm.js"],"sourcesContent":["/**\n * A jQuery plugin to add/remove classes to a collection while a promise is pending or something is loading asynchronously.\n *\n * @license MIT\n * @author Dumitru Uzun (DUzun.Me)\n * @version 1.4.0\n */\nexport default function initLoading($) {\n    const lck = '_loading_class_';\n    const lcd = lck + 'disabled_';\n    const prp = 'disabled';\n    /**\n     * Adds/Removes loading class on the collection.\n     *\n     * Usage:\n     *   1)\n     *       $('selector').loading('loading'); // add class\n     *       ...\n     *       $('selector').loading(false); // remove added loading class\n     *\n     *   2)\n     *       const done = $('selector').loading('loading', true); // add class and get the callback\n     *       ...\n     *       done(); // remove added loading class\n     *\n     *   3)\n     *       $('selector').loading('loading', promise); // add class and remove on promise resolve or reject\n     *\n     *   4)\n     *       const done = $('selector').loading('loading', promise); // add class and remove on promise resolve or reject\n     *       setTimeout(done, 5e3); // timeout if promise takes too long\n     *\n     * @param {String|Array} classes  - classes to be added to collection while loading\n     * @param {Boolean|Promise} retCb - if true, return a done() function to be called when done loading\n     *                                - if a promise, remove classes on resolve or reject\n     *\n     * @return {jQuery|Function} - by default (no retCb) it returns the jQuery collection (this),\n     *                             but if retCb not falsy, done() function returned\n     */\n    const loading = function loading(classes, retCb = undefined) {\n        const that = this;\n        if (classes === false) {\n            that.each(function (i, e) {\n                e = $(e);\n                i = e.data(lck);\n                if (i) {\n                    e.removeClass(i).data(lck, undefined);\n                }\n                i = e.data(lcd);\n                if (i) {\n                    e.attr(i, null).prop(i, false).data(lcd, undefined);\n                }\n            });\n        }\n        else {\n            if (retCb) {\n                // On `.disabled = true` the element loses focus\n                const focused = that.filter(isFocused);\n                that.addClass(classes).attr(prp, prp).prop(prp, true);\n                let done = function (a) {\n                    // Prevent calling it more then once\n                    if (done) {\n                        that.removeClass(classes).attr(prp, null).prop(prp, false);\n                        done = undefined;\n                        // Restore the focus on `.disabled = false`\n                        focused.each(reFocusIf);\n                    }\n                    return arguments.length == 1 ? a : that; // in Promises return the result without altering it\n                };\n                // If retCb is a promise, call done() on resolve and reject\n                if (retCb !== true && $.isFunction(retCb.then)) {\n                    retCb.then(done, done);\n                }\n                return done;\n            }\n            that.each(function (i, e) {\n                e = $(e);\n                i = e.data(lck);\n                e.data(lck, (i ? i + ' ' : '') + classes);\n                if (!e.prop(prp)) {\n                    e.attr(prp, prp).prop(prp, true).data(lcd, prp);\n                }\n            })\n                .addClass(classes);\n        }\n        return that;\n    };\n    $.fn.loading = loading;\n    function isFocused() {\n        const elem = this;\n        return elem.ownerDocument.activeElement === elem;\n    }\n    function reFocusIf() {\n        const elem = this;\n        const { ownerDocument } = elem;\n        const { activeElement } = ownerDocument;\n        // Avoid re-focusing if another element or elem it is focused\n        if (activeElement && (activeElement === elem || activeElement !== ownerDocument.body))\n            return;\n        // Avoid re-focusing if out of viewport to avoid scrolling the page\n        if (!isOnViewport(elem))\n            return;\n        return elem.focus();\n    }\n    // A better inView() version sketch\n    function isOnViewport(elem) {\n        if (!elem.getBoundingClientRect)\n            return;\n        const rect = elem.getBoundingClientRect();\n        if (!rect.height && !rect.width)\n            return false; // display: none ?\n        if (rect.top < 0 || rect.left < 0)\n            return false;\n        const { ownerDocument } = elem;\n        const { documentElement } = ownerDocument;\n        let { clientHeight, clientWidth } = documentElement;\n        if (typeof window !== 'undefined' && window.innerHeight) {\n            clientHeight = window.innerHeight;\n            clientWidth = window.innerWidth;\n        }\n        return (rect.bottom <= clientHeight &&\n            rect.right <= clientWidth);\n    }\n    return loading;\n}\n// Auto-init in browser when jQuery or Zepto is present\nif (typeof window !== 'undefined') {\n    const $ = window.jQuery || window.Zepto;\n    if ($) {\n        initLoading($);\n    }\n}\n"],"names":["initLoading","$","lck","lcd","prp","loading","classes","retCb","undefined","that","each","i","e","data","removeClass","attr","prop","focused","filter","isFocused","addClass","done","a","reFocusIf","arguments","length","isFunction","then","fn","elem","ownerDocument","activeElement","body","isOnViewport","focus","getBoundingClientRect","rect","height","width","top","left","documentElement","clientHeight","clientWidth","window","innerHeight","innerWidth","bottom","right","jQuery","Zepto"],"mappings":"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"}